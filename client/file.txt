 <script>
    async function fetchProgress() {
        try {
            const res = await fetch("/progress");
            const data = await res.json();
            document.getElementById("uploadBar").style.width = data.upload + "%";
            document.getElementById("downloadBar").style.width = data.download + "%";
        } catch (e) {
            console.error("Error fetching progress:", e);
        }
    }

    async function fetchHeartbeat() {
        try {
            const res = await fetch("/status");
            const data = await res.json();

            const container = document.getElementById("nodeStatus");
            container.innerHTML = "";

            // Handle Namenode
            const nnDiv = document.createElement("div");
            nnDiv.className = "node";
            nnDiv.innerHTML = `
                <div class="circle ${data.namenode === "Healthy" ? "alive" : "dead"}"></div>
                <span><strong>Namenode</strong> — ${data.namenode}</span>
            `;
            container.appendChild(nnDiv);

            // Handle Datanodes
            for (const [name, status] of Object.entries(data.datanodes || {})) {
                const div = document.createElement("div");
                div.className = "node";
                div.innerHTML = `
                    <div class="circle ${status === "Alive" ? "alive" : "dead"}"></div>
                    <span>${name} — ${status}</span>
                `;
                container.appendChild(div);
            }

        } catch (e) {
            console.error("Error fetching heartbeat:", e);
        }
    }

    function log(message) {
        const panel = document.getElementById("logPanel");
        const time = new Date().toLocaleTimeString();
        panel.innerHTML += `<div>[${time}] ${message}</div>`;
        panel.scrollTop = panel.scrollHeight;
    }

    document.getElementById("uploadForm").addEventListener("submit", async e => {
        e.preventDefault();
        const file = document.getElementById("uploadFile").files[0];
        const formData = new FormData();
        formData.append("file", file);
        log(`Uploading ${file.name}...`);
        await fetch("/upload", { method: "POST", body: formData });
    });

    document.getElementById("downloadForm").addEventListener("submit", async e => {
        e.preventDefault();
        const filename = document.getElementById("downloadFilename").value;
        const formData = new FormData();
        formData.append("filename", filename);
        log(`Downloading ${filename}...`);
        await fetch("/download", { method: "POST", body: formData });
    });

    // Refresh every few seconds
    setInterval(fetchProgress, 1000);
    setInterval(fetchHeartbeat, 3000);
</script>



//old

<script>
        async function fetchProgress() {
            const res = await fetch("/progress");
            const data = await res.json();
            document.getElementById("uploadBar").style.width = data.upload + "%";
            document.getElementById("downloadBar").style.width = data.download + "%";
        }

        async function fetchHeartbeat() {
            const res = await fetch("/status");
            const nodes = await res.json();
            const container = document.getElementById("nodeStatus");
            container.innerHTML = "";
            nodes.forEach(node => {
                const div = document.createElement("div");
                div.className = "node";
                div.innerHTML = `
                    <div class="circle ${node.alive ? "alive" : "dead"}"></div>
                    <span>${node.name}</span>
                `;
                container.appendChild(div);
            });
        }

        function log(message) {
            const panel = document.getElementById("logPanel");
            const time = new Date().toLocaleTimeString();
            panel.innerHTML += `<div>[${time}] ${message}</div>`;
            panel.scrollTop = panel.scrollHeight;
        }

        document.getElementById("uploadForm").addEventListener("submit", async e => {
            e.preventDefault();
            const file = document.getElementById("uploadFile").files[0];
            const formData = new FormData();
            formData.append("file", file);
            log(`Uploading ${file.name}...`);
            await fetch("/upload", { method: "POST", body: formData });
        });

        document.getElementById("downloadForm").addEventListener("submit", async e => {
            e.preventDefault();
            const filename = document.getElementById("downloadFilename").value;
            const formData = new FormData();
            formData.append("filename", filename);
            log(`Downloading ${filename}...`);
            await fetch("/download", { method: "POST", body: formData });
        });

        setInterval(fetchProgress, 1000);
        setInterval(fetchHeartbeat, 3000);
    </script> 